<?xml version='1.0' encoding='utf-8'?>
<odoo>

    <record id="rule_patient_own_visits" model="ir.rule">
        <field name="name">Patient can see only their own visits</field>
        <field name="model_id" ref="model_hr_hospital_patient_visit"/>
        <field name="groups" eval="[(4, ref('hr_hospital.group_patient'))]"/>
        <field name="domain_force">[('patient_id.partner_id', '=', user.partner_id.id)]</field>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="False"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <record id="rule_intern_own_visits" model="ir.rule">
        <field name="name">Intern can access only their visits</field>
        <field name="model_id" ref="model_hr_hospital_patient_visit"/>
        <field name="groups" eval="[(4, ref('hr_hospital.group_intern'))]"/>
        <field name="domain_force">[('doctor_id.user_id', '=', user.id)]</field>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="True"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
    </record>


    <record id="rule_doctor_own_and_intern_visits" model="ir.rule">
        <field name="name">Doctor can access own and interns visits</field>
        <field name="model_id" ref="model_hr_hospital_patient_visit"/>
        <field name="groups" eval="[(4, ref('hr_hospital.group_doctor'))]"/>
        <field name="domain_force">
            <![CDATA[
                ['|',
                    ('doctor_id.user_id', '=', user.id),
                    ('doctor_id.mentor_id.user_id', '=', user.id)
                ]
            ]]>
        </field>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="True"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <record id="access_hr_hospital_patient_visit_doctor" model="ir.model.access">
        <field name="name">Patient Visit access for Doctor</field>
        <field name="model_id" ref="model_hr_hospital_patient_visit"/>
        <field name="group_id" ref="hr_hospital.group_doctor"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="True"/>
        <field name="perm_create" eval="True"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <record id="rule_manager_all_visits_readonly" model="ir.rule">
        <field name="name">Manager can read all patient visits</field>
        <field name="model_id" ref="model_hr_hospital_patient_visit"/>
        <field name="groups" eval="[(4, ref('hr_hospital.group_manager'))]"/>
        <field name="domain_force">[(1, '=', 1)]</field> <!-- без обмежень -->
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="False"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <record id="access_hr_hospital_patient_visit_admin" model="ir.model.access">
        <field name="name">Patient Visit access for Administrator</field>
        <field name="model_id" ref="model_hr_hospital_patient_visit"/>
        <field name="group_id" ref="hr_hospital.group_admin"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="True"/>
        <field name="perm_create" eval="True"/>
        <field name="perm_unlink" eval="True"/>
    </record>

</odoo>
